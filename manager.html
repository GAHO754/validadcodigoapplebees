<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#111317" />
  <title>Portal de Gerentes — Canje</title>

  <link rel="icon" type="image/png" sizes="32x32" href="manzanas.png">
  <link rel="stylesheet" href="manager.css" />

  <!-- Firebase (Compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <!-- Configuración -->
  <script src="firebase-config.js"></script>

  <!-- Lector QR -->
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body class="bg">
  <noscript>Este portal requiere JavaScript.</noscript>

  <header class="topbar">
    <div class="brand">
      <img src="manzanas.png" alt="logo" class="logo">
      <h1>Gerentes — Canje</h1>
    </div>
    <div class="actions" id="sessionActions" hidden>
      <span id="mgrEmail" class="muted"></span>
      <button id="btnLogout" class="btn ghost" type="button">Salir</button>
    </div>
  </header>

  <main class="container">
    <!-- LOGIN -->
    <section id="loginCard" class="card auth">
      <h2>Acceso de gerentes</h2>
      <p class="muted">Ingresa con tu correo corporativo.</p>
      <form id="loginForm" class="grid" autocomplete="on">
        <label class="field">
          <span>Correo</span>
          <input id="loginEmail" type="email" placeholder="gerente@empresa.com" required>
        </label>
        <label class="field">
          <span>Contraseña</span>
          <input id="loginPass" type="password" placeholder="••••••••" required>
        </label>
        <button id="btnLogin" type="submit" class="btn primary">Entrar</button>
      </form>
      <p id="loginMsg" class="msg"></p>
    </section>

    <!-- DASHBOARD -->
    <section id="dashboard" class="dash" hidden>
      <div class="grid2">
        <!-- ESCÁNER -->
        <article class="card">
          <div class="card-header">
            <h3>Escanear código QR</h3>
            <div class="toggle">
              <label class="switch">
                <input id="switchTorch" type="checkbox">
                <span class="slider"></span>
              </label>
              <small>Linterna</small>
            </div>
          </div>

          <div id="qrRegion" class="qr-region" aria-label="Área de escaneo"></div>

          <div class="row mt8">
            <select id="cameraSelect" class="select" aria-label="Seleccionar cámara"></select>
            <button id="btnStartScan" class="btn" type="button">Iniciar</button>
            <button id="btnStopScan" class="btn ghost" type="button">Detener</button>
          </div>
          <small class="muted">También puedes ingresar el código manualmente.</small>
        </article>

        <!-- VALIDAR CÓDIGO -->
        <article class="card">
          <h3>Buscar/validar por código</h3>
          <div class="row">
            <input id="codeInput" type="text" class="mono" placeholder="Ej. AB3K9T6P2C">
            <button id="btnLookup" class="btn" type="button">Buscar</button>
          </div>

          <hr class="sep">

          <div id="redeemCard" class="redeem" hidden>
            <div class="redeem-head">
              <div>
                <h4 id="rRewardName">—</h4>
                <div class="tags">
                  <span class="tag">Costo: <b id="rCost">0</b> pts</span>
                  <span class="tag">Vence: <b id="rExpires">—</b></span>
                </div>
              </div>
              <div class="status" id="rStatus">—</div>
            </div>

            <div class="grid2 mt8">
              <div class="info">
                <p class="label">Código</p>
                <p class="mono" id="rCode">—</p>

                <p class="label">Cliente (UID)</p>
                <p class="mono" id="rUser">—</p>

                <p class="label">Recompensa</p>
                <p class="mono" id="rRewardId">—</p>
              </div>
              <div class="info">
                <p class="label">Creado</p>
                <p id="rCreated">—</p>

                <p class="label">Estado</p>
                <p id="rState">—</p>
              </div>
            </div>

            <div class="row mt12">
              <label class="field grow">
                <span>Notas (opcional)</span>
                <input id="rNote" type="text" placeholder="Ej. Entregado por Gerente No.2">
              </label>
              <button id="btnRedeem" class="btn primary" type="button">Canjear ahora</button>
            </div>

            <p id="redeemMsg" class="msg"></p>
          </div>
        </article>
      </div>

      <!-- AUDITORÍA -->
      <article class="card mt16">
        <div class="card-header">
          <h3>Últimos canjes</h3>
          <button id="btnReloadAudit" class="btn ghost" type="button">Actualizar</button>
        </div>
        <table class="table" id="auditTable">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Código</th>
              <th>Reward</th>
              <th>Pts</th>
              <th>Cliente</th>
              <th>Gerente</th>
              <th>Estado</th>
              <th>Nota</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </article>
    </section>
  </main>

  <footer class="foot">
    <small>© 2025 Great American Hospitality</small>
  </footer>

  <script src="manager.js"></script>
</body>
</html>
