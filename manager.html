<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#111317" />
  <title>Portal de Gerentes — Canje</title>

  <link rel="icon" type="image/png" sizes="32x32" href="manzanas.png">
  <link rel="stylesheet" href="manager.css" />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <script src="firebase-config.js"></script>

  <!-- Lector QR -->
  <script src="https://unpkg.com/html5-qrcode"></script>

  <!-- Generador QR pequeño -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>

<body class="bg">
  <header class="topbar">
    <div class="brand">
      <img src="manzanas.png" alt="logo" class="logo">
      <h1>Gerentes — Canje</h1>
    </div>
    <div class="actions" id="sessionActions" hidden>
      <span id="mgrEmail" class="muted"></span>
      <button id="btnLogout" class="btn ghost">Salir</button>
    </div>
  </header>

  <main class="container">

    <!-- LOGIN -->
    <section id="loginCard" class="card auth">
      <h2>Acceso de gerentes</h2>
      <form id="loginForm" class="grid">
        <label class="field">
          <span>Correo</span>
          <input id="loginEmail" type="email" placeholder="gerente@empresa.com" required>
        </label>
        <label class="field">
          <span>Contraseña</span>
          <input id="loginPass" type="password" placeholder="••••••••" required>
        </label>
        <button id="btnLogin" class="btn primary">Entrar</button>
      </form>
      <p id="loginMsg" class="msg"></p>
    </section>

    <!-- DASHBOARD -->
    <section id="dashboard" hidden>
      <div class="grid2">

        <!-- ESCÁNER -->
        <article class="card">
          <h3>Escanear código QR</h3>
          <div id="qrRegion" class="qr-region"></div>
          <div class="row">
            <select id="cameraSelect" class="select"></select>
            <button id="btnStartScan" class="btn">Iniciar</button>
            <button id="btnStopScan" class="btn ghost">Detener</button>
          </div>
        </article>

        <!-- VALIDAR MANUAL -->
        <article class="card">
          <h3>Buscar/validar por código</h3>
          <div class="row">
            <input id="codeInput" type="text" class="mono" placeholder="Ej. AB3K9T6P2C">
            <button id="btnLookup" class="btn">Buscar</button>
          </div>

          <hr class="sep">

          <!-- DETALLE DEL CUPÓN -->
          <div id="redeemCard" class="redeem" hidden>
            <h4 id="rRewardName">—</h4>
            <p><b>Código:</b> <span id="rCode">—</span></p>
            <p><b>Cliente:</b> <span id="rUser">—</span></p>
            <p><b>Recompensa:</b> <span id="rRewardId">—</span></p>
            <p><b>Estado:</b> <span id="rStatus">—</span></p>

            <!-- QR CHICO -->
            <div class="mini-qr-wrap" style="margin-top:10px;display:flex;align-items:center;gap:12px;">
              <div id="miniQR" style="width:100px;height:100px;background:#fff;border-radius:8px;padding:4px;box-shadow:0 2px 10px rgba(0,0,0,.25);"></div>
              <small class="muted">Vista previa del QR</small>
            </div>

            <div class="row mt12">
              <label class="field grow">
                <span>Notas</span>
                <input id="rNote" type="text" placeholder="Ej. Entregado por Gerente 2">
              </label>
              <button id="btnRedeem" class="btn primary">Canjear</button>
            </div>

            <p id="redeemMsg" class="msg"></p>
          </div>
        </article>
      </div>
    </section>
  </main>

  <footer class="foot">
    <small>© 2025 Great American Hospitality</small>
  </footer>

  <script src="manager.js"></script>
</body>
</html>
