<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#111317" />
  <title>Portal de Gerentes — Canje</title>

  <link rel="icon" type="image/png" sizes="32x32" href="manzanas.png">
  <link rel="stylesheet" href="manager.css" />

  <!-- Firebase (Compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <!-- Configuración Firebase -->
  <script src="firebase-config.js"></script>

  <!-- QR -->
  <script src="https://unpkg.com/html5-qrcode"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>

<body class="bg">
<noscript>Este portal requiere JavaScript.</noscript>

<header class="topbar">
  <div class="brand">
    <img src="manzanas.png" alt="logo" class="logo">
    <h1>Gerentes — Canje</h1>
  </div>
  <div class="actions" id="sessionActions" hidden>
    <span id="mgrEmail" class="muted"></span>
    <button id="btnLogout" class="btn ghost" type="button">Salir</button>
  </div>
</header>

<main class="container">

<!-- LOGIN -->
<section id="loginCard" class="card auth">
  <h2>Acceso de gerentes</h2>
  <p class="muted">Ingresa con tu correo corporativo.</p>
  <form id="loginForm" class="grid">
    <label class="field">
      <span>Correo</span>
      <input id="loginEmail" type="email" required>
    </label>
    <label class="field">
      <span>Contraseña</span>
      <input id="loginPass" type="password" required>
    </label>
    <button class="btn primary">Entrar</button>
  </form>
  <p id="loginMsg" class="msg"></p>
</section>

<!-- DASHBOARD -->
<section id="dashboard" class="dash" hidden>

<div class="grid2">

<!-- ESCÁNER -->
<article class="card">
  <h3>Escanear código QR</h3>
  <div id="qrRegion" class="qr-region"></div>
  <div class="row mt8">
    <select id="cameraSelect"></select>
    <button id="btnStartScan" class="btn">Iniciar</button>
    <button id="btnStopScan" class="btn ghost">Detener</button>
  </div>
</article>

<!-- VALIDAR -->
<article class="card">
  <h3>Buscar / validar código</h3>
  <div class="row">
    <input id="codeInput" class="mono" placeholder="AB3K9T6P2C">
    <button id="btnLookup" class="btn">Buscar</button>
  </div>

  <hr class="sep">

  <div id="redeemCard" hidden>

    <h4 id="rRewardName">—</h4>

    <p class="label">Código</p>
    <p class="mono" id="rCode">—</p>

    <p class="label">Cliente UID</p>
    <p class="mono" id="rUser">—</p>

    <p class="label">Estado</p>
    <p id="rState">—</p>

    <div class="row mt12">
      <button id="btnInspect" class="btn secondary">
        Inspeccionar cliente
      </button>
    </div>

  </div>
</article>

</div>
</section>

</main>

<!-- ================= MODAL INSPECTOR ================= -->

<div id="inspectModal" class="overlay" hidden>
  <div class="modal modal-xl">

    <div class="modal-head">
      <div>
        <strong>Inspeccionar cliente</strong><br>
        <small id="inspectClientEmail">—</small>
      </div>
      <button id="btnCloseInspect" class="btn ghost">✕</button>
    </div>

    <div class="modal-body">

      <!-- KPIs -->
      <div class="inspect-kpis">
        <div class="kpi-card">
          <strong id="kpiPoints">0</strong>
          <small>Puntos</small>
        </div>
        <div class="kpi-card">
          <strong id="kpiRedeems">0</strong>
          <small>Canjes</small>
        </div>
        <div class="kpi-card">
          <strong id="kpiLastRedeem">—</strong>
          <small>Último canje</small>
        </div>
      </div>

      <!-- ALERTAS -->
      <div class="inspect-alerts">
        <h4>Alertas</h4>
        <ul id="inspectAlerts">
          <li class="ok">✔ Sin alertas</li>
        </ul>
      </div>

      <!-- HISTORIAL -->
      <div class="inspect-history">
        <h4>Historial</h4>
        <ul id="inspectHistory">
          <li>—</li>
        </ul>
      </div>

    </div>

    <div class="modal-foot row">
      <button id="btnCancelInspect" class="btn ghost">Cancelar</button>
      <button id="btnApproveRedeem" class="btn primary">
        Aprobar canje
      </button>
    </div>

  </div>
</div>

<!-- ================= JS ================= -->

<script>
/* ===== MODAL INSPECTOR ===== */

const inspectModal = document.getElementById("inspectModal");
const btnCloseInspect = document.getElementById("btnCloseInspect");
const btnCancelInspect = document.getElementById("btnCancelInspect");
const btnInspect = document.getElementById("btnInspect");

function openInspectModal(data = {}) {
  inspectModal.hidden = false;

  document.getElementById("inspectClientEmail").textContent =
    data.email || "cliente@email.com";

  document.getElementById("kpiPoints").textContent = data.points ?? 0;
  document.getElementById("kpiRedeems").textContent = data.redeems ?? 0;
  document.getElementById("kpiLastRedeem").textContent =
    data.lastRedeem || "—";
}

btnCloseInspect.onclick =
btnCancelInspect.onclick = () => {
  inspectModal.hidden = true;
};

if (btnInspect) {
  btnInspect.onclick = () => {
    // EJEMPLO TEMPORAL
    openInspectModal({
      email: "cliente@demo.com",
      points: 120,
      redeems: 3,
      lastRedeem: "Hoy"
    });
  };
}
</script>

</body>
</html>
